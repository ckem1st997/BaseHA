@using Kendo.Mvc.UI
@using Newtonsoft.Json


@using Microsoft.AspNetCore.Routing


@functions {
    private object _htmlAttributes;
    private object HtmlAttributes
    {
        get
        {
            if (_htmlAttributes != null)
                return _htmlAttributes;
            var htmlAttrData = ViewData["htmlAttributes"];
            if (htmlAttrData != null)
                _htmlAttributes = new RouteValueDictionary(htmlAttrData);
            return _htmlAttributes;
        }
    }

    private bool? _value;
    private bool? Value
    {
        get
        {
            if (_value.HasValue)
                return _value;
            if (ViewData.Model != null)
            {
                _value = Convert.ToBoolean(ViewData.Model, System.Globalization.CultureInfo.InvariantCulture);
            }
            return _value;
        }
    }

    private List<SelectListItem> _triStateValues;
    private List<SelectListItem> TriStateValues
    {
        get
        {
            if (_triStateValues != null)
                return _triStateValues;
            _triStateValues = new List<SelectListItem> {
                new SelectListItem { Text = "", Value = String.Empty, Selected = !Value.HasValue },
                new SelectListItem { Text = "Common.Yes", Value = "true", Selected = Value.HasValue && Value.Value },
                new SelectListItem { Text = "Common.No", Value = "false", Selected = Value.HasValue && !Value.Value },
            };
            return _triStateValues;
        }
    }

}

@if (!ViewData.ModelMetadata.IsNullableValueType)
{
    @Html.CheckBox(string.Empty, Value ?? false, HtmlAttributes)
}
else
{
    @Html.DropDownList(string.Empty, TriStateValues, HtmlAttributes ?? new { @class = "form-control" })
}
